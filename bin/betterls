#!/usr/bin/env bash

if command -v foo >/dev/null 2>&1; then
  echo "betterls requires exa <https://the.exa.website/>, which is not installed.
  Aborting."
  exit 1
fi

# Nicer colours
export EXA_COLORS=di=36:ex=31:ln=35

# Process options using getopts
while getopts ":l" arg
do
  case $arg in
    l)
      iflong=true
      ;;
    \?)
      extraopt=$OPTARG
      ;;
  esac
done

# Shift the argument index so that we have access to the operands, also known
# as the mass arguments (those that are not specific to any argument)
shift $(expr $OPTIND - 1 )

# Return all default arguments
#
# * --git shows a git status flag next to each file
# * --grid forces the output to show in columns
args=(
'--git'
'--grid'
)

# Only show in grid mode if the output is more than four lines long. This is to
# prevent output in which the grid does not provide any benefit.
export EXA_GRID_ROWS=4

# Process long option
[ "$iflong" = true ] && args+=('--long')

# Return any other flags that may have been passed
if [ ! -z "$extraopt" ]; then
  args+=(
  "-$extraopt"
  )
fi

# Return all operands
file="$(
while test $# -gt 0; do
  echo $1
  shift
done
)"

# Create a variable storing the command to be executed
cmd="exa ${args[@]} $file"

# Now actually call the command
command $cmd

# Reset the argument index
OPTIND=1
