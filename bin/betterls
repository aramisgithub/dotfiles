#!/usr/bin/env bash

# Process options using getopts
while getopts ":la" arg
do
  case $arg in
    l)
      iflong=true
      ;;
    a)
      ifall=true
      ;;
    \?)
      extraopt=$OPTARG
      ;;
  esac
done

# Shift the argument index so that we have access to the operands, also known
# as the mass arguments (those that are not specific to any argument)
shift $(expr $OPTIND - 1 )

# Return all default arguments
#
# * --git shows the git status of each file, if applicable
# * --group-directories-first does what it says on the tin
args=(
'--git'
'--group-directories-first'
)

# Process long option
[ "$iflong" = true ] && args+=('--long')

# Process show hidden files option
[ "$ifall" = true ] && args+=('--all')

# Return any other flags that may have been passed
if [ ! -z "$extraopt" ]; then
  args+=(
  "-$extraopt"
  )
fi

# Return all operands
file="$(
while test $# -gt 0; do
  printf '%s' "$1"
  shift
done
)"

# Create a variable storing the command to be executed
cmd="exa ${args[@]} -- $file"

# Now actually call the command
command $cmd

# Reset the argument index
OPTIND=1
