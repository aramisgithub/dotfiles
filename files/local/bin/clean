#!/usr/bin/env bash

cd ~

read -p "
Are you sure? This script will delete all files and folders that the creator
thought of as unnecessary junk, and remove any unnecessary homebrew
dependencies. Updates will also occur.
[Y/n]" -n 1 -r

echo    # (optional) move to a new line
if [[ $REPLY =~ ^[Yy]$ ]]
then
  echo "
  Now for the package manager clear-out!"

  # Fix some brew things
  brew update
  brew prune
  brew cleanup
  brew doctor

  # Uninstall all packages
  pip3 freeze | xargs pip3 uninstall -y
  gem uninstall -aIx
  brew remove --force --ignore-dependencies $(brew list)

  cd ~/dotfiles

  # Install all packages
  ./brew.sh
  bundle install
  pip3 install -r Pipfile

  cd ~

  # Update/upgrade all packages
  brew update
  brew upgrade
  pip3 freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip3 install -U
  sudo gem update `gem list | cut -d ' ' -f 1`

  # Fix some brew things
  brew prune
  brew cleanup
  brew doctor

  /usr/local/bin/rmtrash ~/.less*
  /usr/local/bin/rmtrash ~/.cache
  /usr/local/bin/rmtrash ~/.bash*
  /usr/local/bin/rmtrash ~/.hyper*
  /usr/local/bin/rmtrash ~/.config/nvim/.netrwhist
  /usr/local/bin/rmtrash ~/.cups
  /usr/local/bin/rmtrash ~/.vim*
  /usr/local/bin/rmtrash ~/.oracle*
  /usr/local/bin/rmtrash ~/.emacs*

  sudo find / -name '.DS_Store' -type f -delete
  sudo find ~/box -name 'Icon*' -type f -delete

  echo "
  Here! Take a look at that *clean* home folder:"
  sleep 2
  cd ~
  ls -aGHl

else
  echo " Quitting script."
fi
